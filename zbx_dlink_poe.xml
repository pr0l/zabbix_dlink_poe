zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 8f3b6f2c7c1b4b1a9f528f7a2a2b3c4d
      name: 'Network devices'
  templates:
    - uuid: 2c1a9e140a3d4f2e8d719b4c1d2e3f40
      template: DLink_DGS1210_28P_PoE
      name: 'D-Link DGS-1210-28P PoE'
      groups:
        - name: 'Network devices'
      discovery_rules:
        - uuid: 4a1b2c3d5e6f4a7b8c9da0b1c2d3e4f5
          name: 'Physical interfaces discovery (IF-MIB)'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFINDEX},1.3.6.1.2.1.2.2.1.1,{#IFNAME},1.3.6.1.2.1.31.1.1.1.1,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: if.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              - macro: '{#IFTYPE}'
                value: ^6$
                formulaid: A
          item_prototypes:
            - uuid: 5b2c3d4e6f704b819c02b3c4d5e6f708
              name: 'PoE status ({#IFNAME})'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.105.1.1.1.6.1.{#IFINDEX}'
              key: 'poe.port.status[{#IFINDEX}]'
              delay: 3m
              history: 30d
              valuemap:
                name: 'PoE port detection status (POWER-ETHERNET-MIB)'
              tags:
                - tag: interface
                  value: '{#IFNAME}'
              trigger_prototypes:
                - uuid: 6c3d4e5f70814c928d13c4d5e6f70819
                  expression: 'last(/DLink_DGS1210_28P_PoE/poe.port.status[{#IFINDEX}])<>3 and last(/DLink_DGS1210_28P_PoE/poe.port.status[{#IFINDEX}],#2)=3'
                  name: 'PoE down ({#IFNAME})'
                  priority: HIGH
                  description: 'PoE перестал подавать питание на порт (было deliveringPower(3), стало другое состояние).'
                  manual_close: 'YES'
                  tags:
                    - tag: interface
                      value: '{#IFNAME}'
      valuemaps:
        - uuid: 3d7e2f101b2c4a3d8e90a1b2c3d4e5f6
          name: 'PoE port detection status (POWER-ETHERNET-MIB)'
          mappings:
            - value: '1'
              newvalue: PowerOFF
            - value: '2'
              newvalue: PowerON
            - value: '3'
              newvalue: deliveringPower
            - value: '4'
              newvalue: fault
            - value: '5'
              newvalue: test
            - value: '6'
              newvalue: otherFault
            - value: '0'
              newvalue: disabled
